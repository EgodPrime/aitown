# 一、概述

目标：构建一个在局域网内运行的多人观察型沙盒，玩家可以在浏览器中创建并配置 LLM 驱动的 NPC，观察 NPC 在固定地图中生活、工作与社交。系统以“玩家创造 NPC，观察小镇”为核心互动模式。

重要调整（已由产品决策）：
- 服务器为所有 NPC 提供默认的 OpenAI 兼容 LLM（可配置）；玩家也可以为自己的 NPC 指定自己拥有的 OpenAI 兼容 API（通过安全方式保存在服务器上或由玩家提供的连接字符串）。
- 玩家无权通过前端暂停或继续仿真；小镇时间会持续流逝。仿真暂停/恢复仅由服务器管理员通过命令行工具或管理接口执行。
- 玩家修改 NPC 的 prompt 后，变更不会总是立即反映为行为改变；NPC 会在随时间推进的仿真步中基于新 prompt 逐步调整行为。
- 每个玩家只能拥有且管理一个 NPC，且只能编辑自己的 NPC（边界由会话或玩家标识控制）。
- 前端在 MVP 中可简化为文本驱动的展示：NPC 信息、小镇地点、时间与社交事件均以文本形式呈现，不要求头像或立绘。

背景与动机：本项目旨在展示 LLM 与模拟的结合，提供沉浸式但低交互门槛的体验，适合教育演示、AI 社区实验与本地局域网社交演示。

受众：本地小型用户群（家庭/教育/黑客松参与者），对 AI、模拟与轻量多人体验感兴趣的用户。

成功指标：
- 基本功能可用：用户能创建 NPC、修改其 prompt，并能看到 NPC 在地图上基于 prompt 的行为变化（移动、工作、社交、发言）。
- 稳定运行：在单机/小型局域网环境下，支持 20-50 个 NPC 的同时仿真与消息广播。
- 可演示 LLM 驱动的行为多样性（通过 prompt 可观察不同模式）。

新增成功指标（资源与经济相关）：
- NPC 能够管理基本生存属性（饱食度、能量、心情），这些属性归零将导致 NPC 死亡（仿真中移除/标记）。
- NPC 拥有包裹（inventory）与金钱（currency）系统，能够携带物品并用于购买/消费。
- NPC 能通过工作赚取金钱，且每天会收到服务器发放的基础生存保障金（可配置数量）。

时间与动作速率（成功指标相关）:
- 小镇时间流速：现实世界 36 分钟 = 小镇 1 天（24 小时模拟）。这意味着一天将分配为仿真日轮转周期，管理日结与保障金发放。
- NPC 行动频率：每个 NPC 每 90 秒可执行一次行动（行为决策与执行在该时间点产生并广播状态更新）。
